# Mac 外置设备弹出脚本

这是一个用Python编写的脚本，用于安全弹出Mac上所有挂载的外置设备，包括USB驱动器、外部硬盘、SD卡等。

## 功能特性

- 🔄 **安全弹出**：自动排除系统卷和主硬盘，避免意外卸载系统
- 🛡️ **多重保护**：使用双重验证机制确保只弹出真正的外部设备
- ⚡ **高效执行**：并行处理多个设备，提高弹出效率
- 📊 **静默操作**：无确认提示，直接执行弹出操作

## 支持的设备类型

- ✅ USB闪存驱动器
- ✅ 外部硬盘
- ✅ SD卡读卡器
- ✅ 磁盘镜像(.dmg)
- ✅ 网络共享卷
- ❌ 系统主硬盘（自动保护）
- ❌ 系统恢复分区
- ❌ Time Machine备份卷

## 使用方法

### 直接运行

```bash
python3 eject_all_devices.py
```

### 添加执行权限后运行

```bash
chmod +x eject_all_devices.py
./eject_all_devices.py
```

### 安装到系统路径（可选）

```bash
sudo cp eject_all_devices.py /usr/local/bin/
sudo chmod +x /usr/local/bin/eject_all_devices.py
```

安装后，您可以在任何位置直接运行：

```bash
eject_all_devices.py
```

## 脚本执行流程

1. **扫描挂载卷**：获取所有挂载在`/Volumes/`下的卷信息
2. **识别外部设备**：通过系统卷标记和关键词双重验证
3. **安全弹出**：使用`diskutil eject`命令安全弹出设备
4. **错误处理**：如果弹出失败，尝试使用`diskutil unmount`命令

## 技术实现

### 核心函数

- `get_mounted_volumes()`: 获取所有挂载的卷信息
- `is_system_volume()`: 判断是否为系统卷或主硬盘
- `eject_volume()`: 弹出指定的卷

### 安全机制

脚本通过以下方式确保系统安全：

1. **系统卷白名单**：明确排除已知的系统关键卷
2. **关键词过滤**：识别包含系统相关关键词的卷
3. **挂载点验证**：通过挂载路径进一步确认是否为系统卷

## 系统卷保护列表

脚本会自动保护以下系统卷：
- 根目录 `/`
- `/System` 系统目录
- `/Library` 库目录
- `/Users` 用户目录
- `/Applications` 应用程序目录
- `/Volumes/Macintosh HD` 默认系统卷
- `/Volumes/Macintosh HD - Data` 默认数据卷

## 系统要求

- macOS 10.12 或更高版本
- Python 3.6 或更高版本
- 需要终端访问权限
- 可能需要管理员权限执行某些操作

## 注意事项

1. **数据安全**：确保设备没有正在使用的文件
2. **权限要求**：某些操作可能需要输入密码
3. **静默操作**：脚本直接执行，无确认提示
4. **网络卷**：网络共享卷可能无法正常弹出

## 故障排除

如果脚本无法正常弹出设备，请尝试：

1. 检查设备是否被其他程序占用
2. 手动使用`diskutil list`查看设备状态
3. 确保有足够的权限执行操作
4. 检查Python版本是否符合要求

## 代码结构

```
eject_all_devices.py
├── 导入模块和文档字符串
├── get_mounted_volumes() - 获取挂载卷信息
├── is_system_volume() - 系统卷识别
├── eject_volume() - 单个卷弹出
├── main() - 主函数和执行流程
└── 脚本入口点
```

## 许可证

此脚本为开源软件，可自由使用和修改。